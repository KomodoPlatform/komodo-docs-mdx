/trade_preimage:
  post:
    operationId: trade_preimage
    summary: Trade Preimage (v2)
    description: |
      Returns the approximate fee amounts that are paid per the whole swap.
      This method can be used instead of max_taker_vol, if the max field is true and the swap_method is buy or sell.
    x-mdx-doc-path: ../../src/pages/komodo-defi-framework/api/v20/swaps_and_orders/trade_preimage/index.mdx
    requestBody:
      required: true
      content:
        application/json:
          schema:
            allOf:
              - $ref: '../../../components/schemas/Common.yaml#/RpcV2Request'
              - type: object
                properties:
                  method:
                    type: string
                    enum: ["trade_preimage"]
                    description: The method name
                    example: "trade_preimage"
                  params:
                    type: object
                    required:
                      - base
                      - rel
                      - swap_method
                      - price
                    properties:
                      base:
                        $ref: ../../components/schemas/Common.yaml#/CoinTicker
                        description: The base currency of the request
                      rel:
                        $ref: ../../components/schemas/Common.yaml#/CoinTicker
                        description: The rel currency of the request
                      swap_method:
                        type: string
                        enum: ["buy", "sell", "setprice"]
                        description: The name of the method whose preimage is requested
                        example: "setprice"
                      price:
                        oneOf:
                          - $ref: ../../components/schemas/Common.yaml#/AmountString
                          - type: number
                          - $ref: ../../components/schemas/Orders.yaml#/RationalValue
                        description: The price in rel the user is willing to pay per one unit of the base coin
                        example: "1"
                      volume:
                        oneOf:
                          - $ref: ../../components/schemas/Common.yaml#/AmountString
                          - type: number
                          - $ref: ../../components/schemas/Orders.yaml#/RationalValue
                        description: The amount the user is willing to trade; ignored if max = true and swap_method = setprice, otherwise it must be set
                        example: "0.1"
                      max:
                        type: boolean
                        description: Whether to return the maximum available volume for setprice method; must not be set or false if swap_method is buy or sell
                        example: false
    responses:
      '200':
        description: Trade preimage calculated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../../components/schemas/Common.yaml#/RpcSuccessResponse'
                - type: object
                  properties:
                    result:
                      type: object
                      properties:
                        base_coin_fee:
                          type: object
                          description: A standard ExtendedFeeInfo object. The approximate miner fee paid per the whole swap concerning the base coin
                          properties:
                            coin:
                              $ref: ../../components/schemas/Common.yaml#/CoinTicker
                              description: The coin for which the fee is calculated
                            amount:
                              $ref: ../../components/schemas/Common.yaml#/AmountString
                              description: The fee amount in decimal representation
                            amount_fraction:
                              type: object
                              description: The fee amount as a fraction
                              properties:
                                numer:
                                  type: string
                                  example: "1"
                                denom:
                                  type: string
                                  example: "100000"
                              required:
                                - numer
                                - denom
                            amount_rat:
                              $ref: ../../components/schemas/Orders.yaml#/RationalValue
                              description: The fee amount as a rational value
                            paid_from_trading_vol:
                              type: boolean
                              description: Whether the fee is paid from trading volume
                              example: false
                          required:
                            - coin
                            - amount
                            - amount_fraction
                            - amount_rat
                            - paid_from_trading_vol
                        rel_coin_fee:
                          type: object
                          description: A standard ExtendedFeeInfo object. The approximate miner fee paid per the whole swap concerning the rel coin
                          properties:
                            coin:
                              $ref: ../../components/schemas/Common.yaml#/CoinTicker
                              description: The coin for which the fee is calculated
                            amount:
                              $ref: ../../components/schemas/Common.yaml#/AmountString
                              description: The fee amount in decimal representation
                            amount_fraction:
                              type: object
                              description: The fee amount as a fraction
                              properties:
                                numer:
                                  type: string
                                  example: "15391"
                                denom:
                                  type: string
                                  example: "50000000"
                              required:
                                - numer
                                - denom
                            amount_rat:
                              $ref: ../../components/schemas/Orders.yaml#/RationalValue
                              description: The fee amount as a rational value
                            paid_from_trading_vol:
                              type: boolean
                              description: Whether the fee is paid from trading volume
                              example: true
                          required:
                            - coin
                            - amount
                            - amount_fraction
                            - amount_rat
                            - paid_from_trading_vol
                        volume:
                          $ref: ../../components/schemas/Common.yaml#/AmountString
                          description: Optional. The max available volume that can be traded (in decimal representation); empty if the max argument is missing or false
                        volume_rat:
                          $ref: ../../components/schemas/Orders.yaml#/RationalValue
                          description: Optional. The max available volume that can be traded as a rational value
                        volume_fraction:
                          type: object
                          description: Optional. The max available volume that can be traded as a fractional value
                          properties:
                            numer:
                              type: string
                              example: "14230858589"
                            denom:
                              type: string
                              example: "12500000"
                          required:
                            - numer
                            - denom
                        taker_fee:
                          type: object
                          description: A standard ExtendedFeeInfo object. The dex fee to be paid by Taker; empty if swap_method is setprice
                          properties:
                            coin:
                              $ref: ../../components/schemas/Common.yaml#/CoinTicker
                              description: The coin for which the fee is calculated
                            amount:
                              $ref: ../../components/schemas/Common.yaml#/AmountString
                              description: The fee amount in decimal representation
                            amount_fraction:
                              type: object
                              description: The fee amount as a fraction
                              properties:
                                numer:
                                  type: string
                                  example: "1"
                                denom:
                                  type: string
                                  example: "7770"
                              required:
                                - numer
                                - denom
                            amount_rat:
                              $ref: ../../components/schemas/Orders.yaml#/RationalValue
                              description: The fee amount as a rational value
                            paid_from_trading_vol:
                              type: boolean
                              description: Whether the fee is paid from trading volume
                              example: false
                          required:
                            - coin
                            - amount
                            - amount_fraction
                            - amount_rat
                            - paid_from_trading_vol
                        fee_to_send_taker_fee:
                          type: object
                          description: A standard ExtendedFeeInfo object. The approximate miner fee paid to send the dex fee; empty if swap_method is setprice
                          properties:
                            coin:
                              $ref: ../../components/schemas/Common.yaml#/CoinTicker
                              description: The coin for which the fee is calculated
                            amount:
                              $ref: ../../components/schemas/Common.yaml#/AmountString
                              description: The fee amount in decimal representation
                            amount_fraction:
                              type: object
                              description: The fee amount as a fraction
                              properties:
                                numer:
                                  type: string
                                  example: "1"
                                denom:
                                  type: string
                                  example: "10000"
                              required:
                                - numer
                                - denom
                            amount_rat:
                              $ref: ../../components/schemas/Orders.yaml#/RationalValue
                              description: The fee amount as a rational value
                            paid_from_trading_vol:
                              type: boolean
                              description: Whether the fee is paid from trading volume
                              example: false
                          required:
                            - coin
                            - amount
                            - amount_fraction
                            - amount_rat
                            - paid_from_trading_vol
                      required:
                        - base_coin_fee
                        - rel_coin_fee
      '400':
        description: Bad request
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../../components/schemas/Common.yaml#/RpcErrorResponse'
                - type: object
                  properties:
                    error_type:
                      type: string
                      description: Type of error
                      enum:
                        - "InvalidParam"
                        - "CoinNotFound"
                        - "TransportError"
      '500':
        description: Internal server error
        content:
          application/json:
            schema:
              $ref: '../../../components/schemas/Common.yaml#/RpcErrorResponse' 