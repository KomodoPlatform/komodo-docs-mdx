export const title = "Komodo DeFi Framework Method: Buy";
export const description = "The buy method issues a buy request and attempts to match an order from the orderbook based on the provided arguments.";

# Buy

## buy {{label : 'buy', tag : 'API-v1'}}

The `buy` method issues a buy request and attempts to match an order from the orderbook based on the provided arguments.

<Note>
  *   Buy and sell methods always create the `taker` order first. A `taker` order must pay a `dexfee` during the swap as it is taking liquidity from the market. The `dexfee` is calculated as "the greater of either `Minimum transaction amount (dust) TAKER COIN` or `0.0001 TAKER COIN` or `1/777th` the size of the desired order". If your `GoodTillCancelled` order is not matched in 30 seconds, the order is automatically converted to a `maker` request and stays on the orderbook until the request is matched or cancelled. To always act as a maker, please use the [setprice](/komodo-defi-framework/api/legacy/setprice/) method.
  *   To prevent a user from making trades in which the transaction fees may end up costing a significant portion of the value of the trade, we have set a lower limit to the value of a trade. See the description of the `volume` and `min_volume` arguments for more info.
</Note>

### Request arguments

| Parameter         | Type    | Required | Default | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ----------------- | ------- | :------: | :-----: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| base              | string  |     ✓    |    -    | The name of the coin the user desires to receive                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| rel               | string  |     ✓    |    -    | The name of the coin the user desires to sell                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| price             | various |     ✓    |    -    | The price in `rel` the user is willing to pay per one unit of the `base` coin. Can be a numeric string, expressed using standard [RationalValue](/komodo-defi-framework/api/common_structures/#rational-value) or [FractionalValue](/komodo-defi-framework/api/common_structures/#fractional-value) objects.                                                                                                                                                                                                                                                   |
| volume            | various |     ✓    |    -    | The amount of coins the user is willing to receive of the `base` coin; the following values must be greater than or equal to the `min_trading_vol` of the corresponding coin: <ul><li>the argument `volume`</li><li>the product of the arguments `volume` and `price`</li></ul>. Can be a numeric string, expressed using standard [RationalValue](/komodo-defi-framework/api/common_structures/#rational-value) or [FractionalValue](/komodo-defi-framework/api/common_structures/#fractional-value) objects.                                                 |
| min\_volume       | various |     ✗    |    -    | The minimum amount of `base` coin to be purchased in any `GoodTillCancelled` orders after conversion to maker; the following values must be greater than or equal to the `min_trading_vol` of the corresponding coin: <ul><li>the argument `min_volume`</li><li>the product of the arguments `min_volume` and `price`</li></ul>. Can be a numeric string, expressed using standard [RationalValue](/komodo-defi-framework/api/common_structures/#rational-value) or [FractionalValue](/komodo-defi-framework/api/common_structures/#fractional-value) objects. |
| match\_by         | object  |     ✗    |    -    | Optional. A standard [MatchBy](/komodo-defi-framework/api/common_structures/orders/#match-by) object, to filter to include only matches by pubkey or uuid. *Important:* This condition is not applied after a `GoodTillCancelled` order is converted to a `maker` request.                                                                                                                                                                                                                                                                                     |
| order\_type       | object  |     ✗    |    -    | Optional. A standard [OrderType](/komodo-defi-framework/api/common_structures/orders/#order-type) object.                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| base\_confs       | number  |     ✗    |    -    | Number of required blockchain confirmations for base coin atomic swap transaction; default to base coin configuration if not set                                                                                                                                                                                                                                                                                                                                                                                                                               |
| base\_nota        | boolean |     ✗    |    -    | Whether dPoW notarization is required for base coin atomic swap transaction; default to base coin configuration if not set                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| rel\_confs        | number  |     ✗    |    -    | Number of required blockchain confirmations for rel coin atomic swap transaction; default to rel coin configuration if not set                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| rel\_nota         | boolean |     ✗    |    -    | Whether dPoW notarization is required for rel coin atomic swap transaction; default to rel coin configuration if not set                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| save\_in\_history | boolean |     ✗    |  `true` | Defaults to `true`. If set to `false` no order history will be saved (though order status will be temporarily stored while in progress). If `true`, each order's short record history is stored in a local SQLite database table, and when the order is cancelled or fully matched, its history will be saved as a json file                                                                                                                                                                                                                                   |

### Response

| Parameter               | Type     | Description                                                                                                                                                                                                              |
| ----------------------- | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| action                  | string   | The action of the request (`Buy`)                                                                                                                                                                                        |
| base                    | string   | The base currency of request                                                                                                                                                                                             |
| base\_amount            | string   | The resulting amount of base currency that is received if the order matches (in decimal representation)                                                                                                                  |
| base\_amount\_rat       | rational | The resulting amount of base currency that is received if the order matches, represented as a standard [RationalValue](/komodo-defi-framework/api/common_structures/#rational-value) object.                             |
| rel                     | string   | The rel currency of the request                                                                                                                                                                                          |
| rel\_amount             | string   | The maximum amount of `rel` coin that is spent in order to buy the `base_amount` (according to `price`, in decimal representation)                                                                                       |
| rel\_amount\_rat        | rational | The maximum amount of `rel` coin that is spent in order to buy the `base_amount` (according to `price`, represented as a standard [RationalValue](/komodo-defi-framework/api/common_structures/#rational-value) object). |
| method                  | string   | This field is used for internal P2P interactions; the value is always equal to "request"                                                                                                                                 |
| dest\_pub\_key          | string   | Reserved for future use. `dest_pub_key` allows the user to choose the P2P node that is eligible to match with the request. This value defaults to a "zero pubkey", which means `anyone` can be a match                   |
| sender\_pubkey          | string   | The public key of this node                                                                                                                                                                                              |
| uuid                    | string   | The request uuid                                                                                                                                                                                                         |
| match\_by               | object   | A standard [MatchBy](/komodo-defi-framework/api/common_structures/orders/#match-by) object, to filter to include only matches by pubkey or uuid.                                                                         |
| conf\_settings          | object   | A standard [ConfSettings](/komodo-defi-framework/api/common_structures/orders/#conf-settings) object.                                                                                                                    |
| base\_orderbook\_ticker | string   | The ticker of the base currency if `orderbook_ticker` is configured for the base currency in `coins` file. If not defined, will return a null value.                                                                     |
| rel\_orderbook\_ticker  | string   | The ticker of the rel currency if `orderbook_ticker` is configured for the rel currency in `coins` file. If not defined, will return a null value.                                                                       |

#### 📌 Examples

#### Request (decimal representation)

<CodeGroup title="buy" tag="POST" label="buy" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "method": "buy",
    "base": "DOC",
    "rel": "MARTY",
    "price": 1.1,
    "volume": 2.4
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  #### Response (success)

  ```json
  {
      "action": "Buy",
      "base": "DOC",
      "base_amount": "2.4",
      "rel": "MARTY",
      "rel_amount": "2.64",
      "method": "request",
      "sender_pubkey": "...",
      "uuid": "..."
  }
  ```
</CollapsibleSection>

<CollapsibleSection expandedText="Hide Error Response" collapsedText="Show Error Response">
  #### Response (error)

  ```json
  { "error": "Insufficient balance" }
  ```
</CollapsibleSection>
