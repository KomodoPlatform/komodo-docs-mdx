export const title = "Komodo DeFi Framework Method: Get New Address";
export const description = "The methods in this document allow generation of HD addresses on Komodo DeFi Framework.";

import trezorpin from "@/public/images/docs/api-images/trezor_pin.png";

# Task: Get New Address

## task::get\_new\_address::init  {{label : 'task::get_new_address::init', tag : 'API-v2'}}

A hierarchical-deterministic (HD) wallet generates a new key pair from a master key pair, allowing for multiple addresses to be generated from the same seed so that change from transactions go to a previously unused address, enhancing privacy and security.
The hierarchical structure resembles that of a tree, with the master key "determining" the key pairs that follow it in the hierarchy. If you are running KDF in HD mode, and don't already have too many unused addresses, you can use the `get_new_address` method to generate a new address. The generated address will be shown in the task::account\_balance RPCs and at the next coin activation.

### Request Arguments

| Parameter   | Type    | Required | Default    | Description                                                                                                                                                                                                                                                                                                                 |
| ----------- | ------- | :------: | :--------: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| coin        | string  |    âœ“     |    `-`     | The ticker of the coin you want to get a new address for                                                                                                                                                                                                                                                                    |
| account\_id | integer |    âœ—     |    `0`     | Generally this will be `0` unless you have multiple accounts registered on your Trezor                                                                                                                                                                                                                                      |
| chain       | string  |    âœ—     | `External` | `Internal`, or `External`. External is used for addresses that are intended to be visible outside of the wallet (e.g. for receiving payments). Internal is used for addresses which are not meant to be visible outside of the wallet and is used to return the leftover change from a transaction. |
| gap\_limit  | integer |    âœ—     |    `20`    | The maximum number of empty addresses in a row. Defaults to the value provided on activation or 20 if no value was provided                                                                                                                                                                                       |

### Response Parameters

| Parameter    | Type   | Required | Description                                                                                                |
| ------------ | ------ | :------: | ---------------------------------------------------------------------------------------------------------- |
| new\_address | object |    âœ“     | A standard [NewAddressInfo](/komodo-defi-framework/api/common_structures/wallet/#new-address-info) object. |

Some reasons you might not be able to get a new address are:

*   `EmptyAddressesLimitReached` - Last gap\_limit addresses are still unused.
*   `AddressLimitReached` - Addresses limit reached. Currently, the limit is [2^31](https://www.wolframalpha.com/input?i=2%5E%2832%29)

#### ðŸ“Œ Examples

#### Command

<CodeGroup title="task::get_new_address::init" tag="POST" label="task::get_new_address::init" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "mmrpc": "2.0",
    "method": "task::get_new_address::init",
    "params": {
      "coin": "DOC",
      "account_id": 0,
      "chain": "External",
      "gap_limit": 20
    }
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  #### Response (success)

  ```json
  {
    "mmrpc": "2.0",
    "result": {
      "task_id": 3
    },
    "id": null
  }
  ```
</CollapsibleSection>

## task::get\_new\_address::status   {{label : 'task::get_new_address::status', tag : 'API-v2'}}

Use the `task::get_new_address::status` method to check the status of a HD address creation task.

| Parameter            | Type    | Required | Default | Description                                                                               |
| -------------------- | ------- | :------: | :-----: | ----------------------------------------------------------------------------------------- |
| task\_id             | integer |    âœ“     |   `-`   | The identifying number returned when initiating the task.                                 |
| forget\_if\_finished | boolean |    âœ—     | `true`  | If `false`, will return final response for completed tasks. |

### Response Parameters

| Parameter | Type             | Required | Description                                                                                                                 |
| --------- | ---------------- | :------: | --------------------------------------------------------------------------------------------------------------------------- |
| status    | string           |    âœ“     | Status of the task. `Ok`, `InProgress` or `Error`.                                                                          |
| details   | string or object |    âœ“     | Once complete, a standard [NewAddressesInfo](/komodo-defi-framework/api/common_structures/wallet/#new-address-info) object. |

<CodeGroup title="task::get_new_address::status" tag="POST" label="task::get_new_address::status" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "mmrpc": "2.0",
    "method": "task::get_new_address::status",
    "params": {
      "task_id": 3
    }
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  #### Response (success)

  ```json
  {
      "mmrpc": "2.0",
      "result": {
          "new_address": {
              "address": "RDKyU11wFTa8kYETaDbr4YuJZG8C4e6JUm",
              "derivation_path": "m/44'/141'/0'/0/3",
              "chain": "External",
              "balance": {
                  "spendable": "0",
                  "unspendable": "0"
              }
          }
      },
      "id": null
  }
  ```
</CollapsibleSection>

## task::get\_new\_address::user\_action   {{label : 'task::get_new_address::user_action', tag : 'API-v2'}}

If the `task::get_new_address::status` returns `UserActionRequired`, we need to use the `task::get_new_address::user_action` method to enter our PIN

### Request Arguments

| Parameter                 | Type            | Required | Description                                                                                                                                                                                      |
| ------------------------- | --------------- | :------: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| task\_id                  | integer         |    âœ“     | The identifying number returned when initiating the initialisation process.                                                                                                                      |
| user\_action              | object          |    âœ“     | Object containing the params below                                                                                                                                                               |
| user\_action.action\_type | string          |    âœ“     | Will be `TrezorPin` for this method                                                                                                                                                              |
| user\_action.pin          | string (number) |    âœ“     | When the Trezor device is displaying a grid of numbers for PIN entry, this param will contain your Trezor pin, as mapped through your keyboard numpad. See the image below for more information. |

<OptimizedImage src={trezorpin} classNaming="w-full" alt="Trezor Pin" />

### Response Parameters

| Parameter | Type   | Required | Description                 |
| --------- | ------ | :------: | --------------------------- |
| result    | string |    âœ“     | The outcome of the request. |

<CodeGroup title="task::get_new_address::user_action" tag="POST" label="task::get_new_address::user_action" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "mmrpc": "2.0",
    "method": "task::get_new_address::user_action",
    "params": {
      "task_id": 3,
      "user_action": {
        "action_type": "TrezorPin",
        "pin": "862743"
      }
    }
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  #### Response (success)

  ```json
  {
    "mmrpc": "2.0",
    "result": "success",
    "id": null
  }
  ```
</CollapsibleSection>

## task::get\_new\_address::cancel   {{label : 'task::get_new_address::cancel', tag : 'API-v2'}}

If you want to cancel the enabling process before it has completed, you can use this method.

### Request Arguments

| Parameter | Type    | Required | Description                                                           |
| --------- | ------- | :------: | --------------------------------------------------------------------- |
| task\_id  | integer |    âœ“     | The identifying number returned when initiating the enabling process. |

### Response Parameters

| Parameter    | Type   | Required | Description                                                    |
| ------------ | ------ | :------: | -------------------------------------------------------------- |
| result       | string |    âœ“     | Indicates task cancellation was succesful.                     |
| error        | string |    âœ—     | An error message to explain what went wrong.                   |
| error\_path  | string |    âœ—     | An indicator of the class or function which reurned the error. |
| error\_trace | string |    âœ—     | An indicator of where in the source code the error was thrown. |
| error\_type  | string |    âœ—     | An enumerated value for the returned error.                    |
| error\_data  | string |    âœ—     | The input task ID which resulted in the error.                 |

<CodeGroup title="task::get_new_address::cancel" tag="POST" label="task::get_new_address::cancel" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "mmrpc": "2.0",
    "method": "task::get_new_address::cancel",
    "params": {
      "task_id": 3
    }
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  #### Response (success)

  ```json
  {
    "mmrpc": "2.0",
    "result": "success",
    "id": null
  }
  ```
</CollapsibleSection>
