export const title = "Komodo DeFi Framework Method: Account Balance Tasks";
export const description = "The methods in this document allow tracking of balances across multiple addresses under a specified account index.";

# Task: Account Balance

If you have enabled a coin with [task managed activation](/komodo-defi-framework/api/v20/coin_activation/task_managed/) and are using `HD Mode`, your funds may be spread across a range of addresses under a specified account index. The methods below will return the combined balance of your account, detailing the balance for each active account address.

## task::account\_balance::init {{label : 'task::account_balance::init', tag : 'API-v2'}}

Use the `task::account_balance::init` method to initialise an account balance request.

#### Arguments

| Parameter      | Type   | Description                                                                                                                                     |
| -------------- | ------ | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| coin           | string | Ticker of activated coin you want to see addresses and balance for                                                                              |
| account\_index | string | For GUIs, this will be zero. In CLI you can use other values if you [know what you are doing](https://learnmeabitcoin.com/technical/hd-wallets) |

#### Response

| Parameter | Type    | Description                                               |
| --------- | ------- | --------------------------------------------------------- |
| task\_id  | integer | An identifying number which is used to query task status. |

#### ðŸ“Œ Examples

#### Command

<CodeGroup title="task::account_balance::init" tag="POST" label="task::account_balance::init" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "mmrpc": "2.0",
    "method": "task::account_balance::init",
    "params": {
      "coin": "COIN_NAME",
      "account_index": 0
    }
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  #### Response (ready, successful)

  ```json
  {
    "mmrpc": "2.0",
    "result": {
      "task_id": 6
    },
    "id": null
  }
  ```
</CollapsibleSection>

## task::account\_balance::status {{label : 'task::account_balance::status', tag : 'API-v2'}}

Use the `task::account_balance::status` method to view the status / response of an account balance request.

#### Arguments

| Parameter            | Type    | Description                                                                               |
| -------------------- | ------- | ----------------------------------------------------------------------------------------- |
| task\_id             | integer | The identifying number returned when initiating the task.                                 |
| forget\_if\_finished | boolean | If `false`, will return final response for completed tasks. Optional, defaults to `true`. |

#### Response

| Parameter       | Type    | Description                                                                                                                                                                                                          |
| --------------- | ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| current\_block  | integer | Block height of the coin being activated                                                                                                                                                                             |
| ticker          | string  | Ticker of the coin being activated.                                                                                                                                                                                  |
| wallet\_balance | object  | A standard [WalletBalanceInfo](/komodo-defi-framework/api/common_structures/wallet/#wallet-balance-info) object. Note: the structure may vary based on the `get_balances` parameter value in the activation request. |

#### ðŸ“Œ Examples

#### Command

<CodeGroup title="task::account_balance::status" tag="POST" label="task::account_balance::status" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "mmrpc": "2.0",
    "method": "task::account_balance::status",
    "params": {
      "task_id": 3,
      "forget_if_finished": false
    }
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  #### Response (ready, successful)

  ```json
  {
    "mmrpc": "2.0",
    "result": {
      "status": "Ok",
      "details": {
        "account_index": 0,
        "derivation_path": "m/44'/20'/0'",
        "total_balance": {
          "KMD": {
            "spendable": "99.999",
            "unspendable": "0"
          }
        },
        "addresses": [
          {
            "address": "DJdsr4Mhqm1afkbxwBJfwH6236xNh5kJZU",
            "derivation_path": "m/44'/20'/0'/0/0",
            "chain": "External",
            "balance": {
              "KMD": {
                "spendable": "49.999",
                "unspendable": "0"
              }
            }
          },
          {
            "address": "DJdsr4Mhqm1afkbxwBJfwH6236xNh5kJZU",
            "derivation_path": "m/44'/20'/0'/0/1",
            "chain": "External",
            "balance": {
              "KMD": {
                "spendable": "50",
                "unspendable": "0"
              }
            }
          },
          {
            "address": "DJdsr4Mhqm1afkbxwBJfwH6236xNh5kJZU",
            "derivation_path": "m/44'/20'/0'/0/2",
            "chain": "External",
            "balance": {
              "KMD": {
                "spendable": "0",
                "unspendable": "0"
              }
            }
          }
        ]
      }
    },
    "id": null
  }
  ```
</CollapsibleSection>

## task::account\_balance::cancel {{label : 'task::account_balance::cancel', tag : 'API-v2'}}

Use the `task::account_balance::cancel` method to cancel an account balance request.

#### Arguments

| Parameter | Type    | Description                                               |
| --------- | ------- | --------------------------------------------------------- |
| task\_id  | integer | The identifying number returned when initiating the task. |

#### Response

| Parameter    | Type   | Description                                                                            |
| ------------ | ------ | -------------------------------------------------------------------------------------- |
| result       | string | Returns with value `success` when successful, otherwise returns the error values below |
| error        | string | Description of the error                                                               |
| error\_path  | string | Used for debugging. A reference to the function in code base which returned the error  |
| error\_trace | string | Used for debugging. A trace of lines of code which led to the returned error           |
| error\_type  | string | An enumerated error identifier to indicate the category of error                       |
| error\_data  | string | Additonal context for the error type                                                   |

#### ðŸ“Œ Examples

#### Command

<CodeGroup title="task::account_balance::cancel" tag="POST" label="task::account_balance::cancel" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "mmrpc": "2.0",
    "method": "task::account_balance::cancel",
    "params": {
      "task_id": 3,
      "forget_if_finished": false
    }
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  #### Response (ready, successful)

  ```json
  {
    "mmrpc": "2.0",
    "result": "success",
    "id": null
  }
  ```

  #### Response (error, task already finished)

  ```json
  {
    "mmrpc": "2.0",
    "error": "Task is finished already",
    "error_path": "init_account_balance.manager",
    "error_trace": "init_account_balance:113] manager:104]",
    "error_type": "TaskFinished",
    "error_data": 2,
    "id": null
  }
  ```
</CollapsibleSection>
