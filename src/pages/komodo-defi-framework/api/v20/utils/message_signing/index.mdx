export const title = "Komodo DeFi Framework Method: Signing and Verifying Messages";
export const description = "The methods in this document allow you to sign and verify messages for all coins supported by Komodo DeFi Framework.";

# Signing\_and\_Verifying\_Messages

Cryptographically signed messages are a useful feature which can be used to [prove ownership of an address](https://www.coindesk.com/policy/2020/05/25/craig-wright-called-fraud-in-message-signed-with-bitcoin-addresses-he-claims-to-own/).

If your [`coins`](https://github.com/KomodoPlatform/coins) file contains the correct [`sign_message_prefix`](https://bitcoin.stackexchange.com/questions/77324/how-are-bitcoin-signed-messages-generated/77325#77325) parameter value for a coin, you can sign messages with the [Komodo DeFi Framework API](https://github.com/KomodoPlatform/komodo-defi-framework).

```json
{
  "coin": "DOC",
  "asset": "DOC",
  "fname": "DOC (TESTCOIN)",
  "sign_message_prefix": "Komodo Signed Message:\n",
  "rpcport": 25435,
  "txversion": 4,
  "overwintered": 1,
  "mm2": 1,
  "protocol": {
    "type": "UTXO"
  }
}
```

## Sign Message

### Arguments

| Structure | Type   | Description                     |
| --------- | ------ | ------------------------------- |
| coin      | string | The coin to sign a message with |
| message   | string | The message you want to sign    |
| derivation\_path | string           | Required for HD wallets. Follows the format `m/44'/COIN_ID'/ACCOUNT_ID'/CHAIN/ADDRESS_ID` as returned in coin activation response under `details.wallet_balances.accounts.addresses`. |



### Response

| Structure | Type   | Description                             |
| --------- | ------ | --------------------------------------- |
| signature | string | The signature generated for the message |

#### Command

<CodeGroup title="" tag="POST" label="sign_message" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "method": "sign_message",
    "mmrpc": "2.0",
    "id": 0,
    "params": {
      "coin": "DOC",
      "message": "Between subtle shading and the absence of light lies the nuance illusion"
    }
  }
  ```
</CodeGroup>


<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
#### Response (success)

```json
{
  "mmrpc": "2.0",
  "result": {
    "signature": "H43eTmJxBKEPiHkrCe/8NsRidkKCIkXDxLyp30Ez/RwoApGdg89Hlvj9mTMSPGp8om5297zvdL8EVx3IdIe2swY="
  },
  "id": 0
}
```
</CollapsibleSection>

#### Command (HD wallet)

<CodeGroup title="" tag="POST" label="sign_message" mm2MethodDecorate="true">
  ```json
  {
      "userpass": "{{userpass}}",
      "mmrpc": "2.0",
      "method": "sign_message",
      "params": {
          "coin": "KMD",
          "message": "Very little worth knowing is taught by fear.",
          "derivation_path": "m/44'/141'/0'/0/1"
      }
      "id": 2
  }

  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
#### Response (HD, success)

```json
{
    "mmrpc": "2.0",
    "result": {
        "signature": "H8Jk+O21IJ0ob3pchrBkJdlXeObrMAKuABlCtW4JySOUUfxg7K8Vl/H3E4gdtwXqhbCu7vv+NYoIhq/bmjtBlkc="
    },
    "id": 2
}
```

</CollapsibleSection>

### ⚠ Error types

**PrefixNotFound:** sign\_message\_prefix is not set in coin config file
**CoinIsNotFound:** Specified coin is not found
**SigningError:** Error attempting to sign message
**InvalidRequest:** Message signing is not supported by the given coin type
**InternalError:** An internal error occured during the signing process

<CollapsibleSection expandedText="Hide Error Responses" collapsedText="Show Error Responses">

#### PrefixNotFound
```json
{
    "mmrpc": "2.0",
    "error": "sign_message_prefix is not set in coin config",
    "error_path": "eth",
    "error_trace": "eth:2332]",
    "error_type": "PrefixNotFound",
    "id": null
}
```

#### InternalError
```json
{
    "mmrpc": "2.0",
    "error": "Internal error: No such coin: as",
    "error_path": "lp_coins",
    "error_trace": "lp_coins:5122] lp_coins:5034]",
    "error_type": "InternalError",
    "error_data": "No such coin: SHEKEL",
    "id": null
}
```

</CollapsibleSection>

## Verify Message

### Arguments

| Structure | Type   | Description                                          |
| --------- | ------ | ---------------------------------------------------- |
| coin      | string | The coin to sign a message with                      |
| message   | string | The message input via the `sign_message` method sign |
| signature | string | The signature generated for the message              |
| address   | string | The address used to sign the message                 |

### Response

| Structure | Type    | Description                                                 |
| --------- | ------- | ----------------------------------------------------------- |
| is\_valid | boolean | `true` is message signature is valid; `false` if it is not. |

#### Command

<CodeGroup title="" tag="POST" label="verify_message" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "method": "verify_message",
    "mmrpc": "2.0",
    "id": 0,
    "params": {
      "coin": "DOC",
      "message": "Between subtle shading and the absence of light lies the nuance illusion",
      "signature": "H43eTmJxBKEPiHkrCe/8NsRidkKCIkXDxLyp30Ez/RwoApGdg89Hlvj9mTMSPGp8om5297zvdL8EVx3IdIe2swY=",
      "address": "RUYJYSTuCKm9gouWzQN1LirHFEYThwzA2d"
    }
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Responses" collapsedText="Show Responses">
#### Response (valid)

```json
{
  "mmrpc": "2.0",
  "result": {
    "is_valid": true
  },
  "id": 0
}
```

#### Response (not valid)

```json
{
  "mmrpc": "2.0",
  "result": {
    "is_valid": false
  },
  "id": 0
}
```
</CollapsibleSection>

### ⚠ Error types

**PrefixNotFound:** sign\_message\_prefix is not set in coin config
**CoinIsNotFound:** Specified coin is not found
**InvalidRequest:** Message verification is not supported by the given coin type
**InternalError:** An internal error occured during the verification process
**SignatureDecodingError:** Given signature could not be decoded
**AddressDecodingError:** Given address could not be decoded


<CollapsibleSection expandedText="Hide Error Responses" collapsedText="Show Error Responses">

#### PrefixNotFound
```json
{
    "mmrpc": "2.0",
    "error": "sign_message_prefix is not set in coin config",
    "error_path": "eth",
    "error_trace": "eth:2332]",
    "error_type": "PrefixNotFound",
    "id": null
}
```

#### InternalError
```json
{
    "mmrpc": "2.0",
    "error": "Internal error: No such coin: as",
    "error_path": "lp_coins",
    "error_trace": "lp_coins:5122] lp_coins:5034]",
    "error_type": "InternalError",
    "error_data": "No such coin: SHEKEL",
    "id": null
}
```

#### SignatureDecodingError
```json
{
    "mmrpc": "2.0",
    "error": "Signature decoding error: Invalid last symbol 100, offset 86.",
    "error_path": "utxo_common",
    "error_trace": "utxo_common:2803]",
    "error_type": "SignatureDecodingError",
    "error_data": "Invalid last symbol 100, offset 86.",
    "id": null
}
```
</CollapsibleSection>