export const title = "Komodo DeFi Framework Method: BCH Coin Activation Tasks";
export const description =
  "The methods in this document demonstrate the activation of BCH & SLP tokens.";

import trezorpin from "@/public/images/docs/api-images/trezor_pin.png";

# Task: BCH/SLP Activation

## task::enable\_bch::init {{label : 'task::enable_bch::init', tag : 'API-v2'}}

Use this method for task managed activation of BCH and SLP tokens. Refer to the [task managed activation overview](/komodo-defi-framework/api/v20/coin_activation/task_managed/) for activation of other coin types.

#### Arguments

| Parameter                | Type             | Description                                                                                                                                                                                                                                               |
| ------------------------ | ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ticker                   | string           | Ticker of the platform protocol coin. Options: `BCH` or `tBCH`                                                                                                                                                                                            |
| bchd\_urls               | array of strings | A list of BCHD gRPC API server URLs, used for  validation of SLP token transactions. It's recommended to add as many servers as possible. The URLs list can be found at [https://bchd.fountainhead.cash/](https://bchd.fountainhead.cash/).               |
| mode                     | object           | A standard [ActivationMode](/komodo-defi-framework/api/common_structures/activation/#activation-mode) object.                                                                                                                                             |
| tx\_history              | boolean          | If `true`, spawns a background loop to store the local cache of address(es) transactions. Defaults to `false`.                                                                                                                                            |
| slp\_tokens\_requests    | array of objects | A list of standard [TokensRequest](/komodo-defi-framework/api/common_structures/activation/#tokens-request) objects.                                                                                                                                      |
| address\_format          | object           | Optional. Overwrites the address format from coins file, if set. A standard [AddressFormat](/komodo-defi-framework/api/common_structures/wallet/#address-format) object.                                                                                  |
| allow\_slp\_unsafe\_conf | boolean          | Optional, defaults to `false`. If `true`, allows bchd\_urls to be empty. **Warning:** it is highly unsafe to do so as it may lead to invalid SLP transactions generation and tokens burning.                                                              |
| get\_balances            | boolean          | Optional, defaults to `true`. If `false`, coin and token balances will not be returned in the response, and the response will be returned more quickly.                                                                                                   |
| required\_confirmations  | integer          | Optional, defaults to value in the coins file, or `3` if not set. Confirmations to wait for steps in swap.                                                                                                                                                |
| requires\_notarization   | boolean          | Optional, defaults to `true`. Has no effect on BCH.                                                                                                                                                                                                       |
| tx\_history              | boolean          | Optional, defaults to `true`. If `true` the Komodo DeFi Framework API will preload transaction history as a background process. Must be set to `true` to use the [my\_tx\_history](/komodo-defi-framework/api/legacy/my_tx_history/#my-tx-history) method |
| utxo\_merge\_params      | object           | A standard [UtxoMergeParams](/komodo-defi-framework/api/common_structures/activation/#utxo-merge-params) object. Used to reduce a wallet's UTXO count in cases where it is causing significantly slower RPC responses.                                    |
|                          |                  |                                                                                                                                                                                                                                                           |

#### Response

| Parameter | Type    | Description                                               |
| --------- | ------- | --------------------------------------------------------- |
| task\_id  | integer | An identifying number which is used to query task status. |

#### ðŸ“Œ Examples

#### Activation in Trezor mode

<CodeGroup title="task::enable_bch::init" tag="POST" label="task::enable_bch::init" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "mmrpc": "2.0",
    "method": "task::enable_bch::init",
    "params": {
      "ticker": "BCH",
      "activation_params": {
        "bchd_urls": [
          "https://bchd.dragonhound.info"
        ],
        "mode": {
          "rpc": "Electrum",
          "rpc_data": {
            "servers": [
              {
                "url": "bch.imaginary.cash:50002",
                "protocol": "SSL"
              },
              {
                "url": "cashnode.bch.ninja:50002",
                "protocol": "SSL"
              },
              {
                "url": "bch.soul-dev.com:50002",
                "protocol": "SSL"
              },
              {
                "url": "electrum3.cipig.net:20055",
                "protocol": "SSL"
              }
            ]
          }
        },
        "slp_tokens_requests": [
          {
            "ticker": "USDF"
          },
          {
            "ticker": "ASLP-SLP",
            "required_confirmations": 3
          }
        ],
        "tx_history": true,
        "required_confirmations": 5,
        "requires_notarization": false,
        "address_format": {
          "format": "cashaddress",
          "network": "bitcoincash"
        },
        "utxo_merge_params": {
          "merge_at": 50,
          "check_every": 10,
          "max_merge_at_once": 25
        }
      }
    }
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  #### Response

  ```json
  {
    "mmrpc": "2.0",
    "result": {
      "task_id": 1
    },
    "id": null
  }
  ```
</CollapsibleSection>

## task::enable\_bch::status {{label : 'task::enable_bch::status', tag : 'API-v2'}}

After running the `task::enable_bch::init` method, we can query the status of activation to check its progress.
The response will return the following:

*   Result of the task (success or error)
*   Progress status (what state the task is in)
*   Required user action (what user should do before the task can continue)

#### Arguments

| Parameter            | Type    | Description                                                                               |
| -------------------- | ------- | ----------------------------------------------------------------------------------------- |
| task\_id             | integer | The identifying number returned when initiating the initialisation process.               |
| forget\_if\_finished | boolean | If `false`, will return final response for completed tasks. Optional, defaults to `true`. |

#### Command

<CodeGroup title="task::enable_bch::status" tag="POST" label="task::enable_bch::status" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "mmrpc": "2.0",
    "method": "task::enable_bch::status",
    "params": {
      "task_id": 0,
      "forget_if_finished": false
    }
  }
  ```
</CodeGroup>

| Parameter | Type   | Description                                                                                                           |
| --------- | ------ | --------------------------------------------------------------------------------------------------------------------- |
| status    | string | A short indication of how the enabling is progressing.                                                                |
| details   | object | Depending on the state of enabling progress, this will contain different information as shown in the responses below. |

Possible `status` values while activation is in progress:

*   `ActivatingCoin`: The first step of activation. It does not require any action from the user.
*   `RequestingWalletBalance`: The first step of activation, while initial balances info is being requested. It does not require any action from the user.
*   `Finishing`: Activation process completed
*   `WaitingForTrezorToConnect`: Waiting for the user to plugin a Trezor device
*   `FollowHwDeviceInstructions`: Waiting for the user to follow the instructions on the device

Once complete, `status`  will be `Ok`, and the `details` object will have the following structure:

#### Response (ready, successful, HD mode)

| Parameter       | Type    | Description                                                                                                                                                                                                           |
| --------------- | ------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| current\_block  | integer | Block height of the coin being activated                                                                                                                                                                              |
| ticker          | string  | Ticker of the coin being activated.                                                                                                                                                                                   |
| wallet\_balance | object  | A standard [WalletBalanceInfo](/komodo-defi-framework/api/common_structures/wallet/#wallet-balance-info) object. Note: the structure may vary based on the `get_balances` parameter value in the activation request. |

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  ```json
  {
      "mmrpc": "2.0",
      "result": {
          "status": "Ok",
          "details": {
              "ticker": "BCH",
              "current_block": 895348,
              "wallet_balance": {
                  "wallet_type": "HD",
                  "accounts": [
                      {
                          "account_index": 0,
                          "derivation_path": "m/44'/145'/0'",
                          "total_balance": {
                              "BCH": {
                                  "spendable": "0",
                                  "unspendable": "0"
                              }
                          },
                          "addresses": [
                              {
                                  "address": "bitcoincash:qq6qvc33strtjwnfktdqswwvxuhrhs2ussavvhv3a0",
                                  "derivation_path": "m/44'/145'/0'/0/0",
                                  "chain": "External",
                                  "balance": {
                                      "BCH": {
                                          "spendable": "0",
                                          "unspendable": "0"
                                      }
                                  }
                              }
                          ]
                      }
                  ]
              }
          }
      },
      "id": null
  }  
  ```
</CollapsibleSection>

#### Response (ready, successful, Iguana mode)

| Parameter       | Type    | Description                                                                                                                                                                                                           |
| --------------- | ------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| current\_block  | integer | Block height of the coin being activated                                                                                                                                                                              |
| ticker          | string  | Ticker of the coin being activated.                                                                                                                                                                                   |
| wallet\_balance | object  | A standard [WalletBalanceInfo](/komodo-defi-framework/api/common_structures/wallet/#wallet-balance-info) object. Note: the structure may vary based on the `get_balances` parameter value in the activation request. |
<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  ```json
  ```
</CollapsibleSection>

#### Response (in progress)

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  ```json
  {
    "mmrpc": "2.0",
    "result": {
      "status": "InProgress",
      "details": "RequestingWalletBalance"
    },
    "id": null
  }
  ```
</CollapsibleSection>

#### Response (ready, error)

| Parameter      | Type   | Description                                                                                                         |
| -------------- | ------ | ------------------------------------------------------------------------------------------------------------------- |
| status         | string | A short indication of how the requested process is progressing.                                                     |
| details.result | object | Depending on the state of process progress, this will contain different information as detailed in the items below. |
| .error         | string | The ticker of the coin being activated                                                                              |
| .error\_path   | string | Used for debugging. A reference to the function in code base which returned the error                               |
| .error\_trace  | string | Used for debugging. A trace of lines of code which led to the returned error                                        |
| .error\_type   | string | An enumerated error identifier to indicate the category of error                                                    |
| .error\_data   | string | Additonal context for the error type                                                                                |

Possible Error Cases:

*   `TaskTimedOut` - Timed out waiting for coin activation, connecting to the device trezor or for user to confirm pubkey)
*   `CoinCreationError` - Error during activation. E.g. incorrect or inactive electrum servers.
*   `HwError` - **This is the most important error type.** Unlike other error types, `HwError` requires the GUI / User to check the details in `error_data` field to know which action is required. View the [HwError error type details](/komodo-defi-framework/api/v20/utils/task_init_trezor/#details-for-hw-error-error-type) for more info.

## task::enable\_bch::user\_action {{label : 'task::enable_bch::user_action', tag : 'API-v2'}}

If the `task::enable_bch::status` returns `UserActionRequired`, we need to use the `task::enable_bch::user_action` method to enter our PIN

#### Arguments

| Parameter                 | Type            | Description                                                                                                                                                                                      |
| ------------------------- | --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| task\_id                  | integer         | The identifying number returned when initiating the initialisation process.                                                                                                                      |
| user\_action              | object          | Object containing the params below                                                                                                                                                               |
| user\_action.action\_type | string          | Will be `TrezorPin` for this method                                                                                                                                                              |
| user\_action.pin          | string (number) | When the Trezor device is displaying a grid of numbers for PIN entry, this param will contain your Trezor pin, as mapped through your keyboard numpad. See the image below for more information. |

<OptimizedImage src={trezorpin} classNaming="w-full" alt="Trezor Pin" />

#### Response

| Parameter | Type   | Description                 |
| --------- | ------ | --------------------------- |
| result    | string | The outcome of the request. |

#### ðŸ“Œ Examples

#### Command

<CodeGroup title="task::enable_bch::user_action" tag="POST" label="task::enable_bch::user_action" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "mmrpc": "2.0",
    "method": "task::enable_bch::user_action",
    "params": {
      "task_id": 0,
      "user_action": {
        "action_type": "TrezorPin",
        "pin": "862743"
      }
    }
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  #### Response (success)

  ```json
  {
    "mmrpc": "2.0",
    "result": "success",
    "id": null
  }
  ```
</CollapsibleSection>

## task::enable\_bch::cancel {{label : 'task::enable_bch::cancel', tag : 'API-v2'}}

If you want to cancel the enabling process before it has completed, you can use this method.

#### Arguments

| Structure | Type    | Description                                                           |
| --------- | ------- | --------------------------------------------------------------------- |
| task\_id  | integer | The identifying number returned when initiating the enabling process. |

#### Response

| Structure    | Type   | Description                                                    |
| ------------ | ------ | -------------------------------------------------------------- |
| result       | string | Indicates task cancellation was succesful.                     |
| error        | string | An error message to explain what went wrong.                   |
| error\_path  | string | An indicator of the class or function which reurned the error. |
| error\_trace | string | An indicator of where in the source code the error was thrown. |
| error\_type  | string | An enumerated value for the returned error.                    |
| error\_data  | string | The input task ID which resulted in the error.                 |

<CodeGroup title="task::enable_bch::cancel" tag="POST" label="task::enable_bch::cancel" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "method": "task::enable_bch::cancel",
    "mmrpc": "2.0",
    "params": {
      "task_id": 3
    }
  }
  ```
</CodeGroup>

<CollapsibleSection expandedText="Hide Response" collapsedText="Show Response">
  #### Response (success)

  ```json
  {
    "mmrpc": "2.0",
    "result": "success",
    "id": null
  }
  ```
</CollapsibleSection>

<CollapsibleSection expandedText="Hide Error Responses" collapsedText="Show Error Responses">
  #### Response (success - already finished)

  ```json
  {
    "mmrpc": "2.0",
    "error": "Task is finished already",
    "error_path": "init_standalone_coin.manager",
    "error_trace": "init_standalone_coin:144] manager:101]",
    "error_type": "TaskFinished",
    "error_data": 0,
    "id": null
  }
  ```

  #### Response (error - no such task)

  ```json
  {
    "mmrpc": "2.0",
    "error": "No such task '1'",
    "error_path": "init_standalone_coin",
    "error_trace": "init_standalone_coin:119]",
    "error_type": "NoSuchTask",
    "error_data": 1,
    "id": null
  }
  ```
</CollapsibleSection>
